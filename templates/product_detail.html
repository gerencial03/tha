{% extends "base.html" %}

{% block content %}

<!-- Product Detail Page -->
<div class="product-detail-page">


    <!-- Product Title - Large and Above Image -->
    <div class="container mt-4">
        <div class="text-center mb-4">
            <h1 class="product-title-large" style="font-size: 1.8rem; font-weight: bold; color: #333; line-height: 1.2;">{{ product.name }}</h1>
        </div>
    </div>

    <!-- Main Product Section -->
    <div class="container">
        <div class="row">
            <!-- Product Image -->
            <div class="col-md-6 mb-4">
                <div class="product-image-container">
                    <img src="{{ product.image_url }}" alt="{{ product.name }}" class="img-fluid product-main-image" style="max-height: 300px; object-fit: cover; width: 100%;">
                </div>
            </div>

            <!-- Product Info -->
            <div class="col-md-6">
                <div class="product-info-section">

                    <!-- Rating -->
                    <div class="product-rating mb-3">
                        {% for i in range(5) %}
                            <i class="fas fa-star {{ 'text-warning' if i < product.rating else 'text-muted' }}"></i>
                        {% endfor %}
                        <span class="ms-2">{{ product.review_count }} avalia√ß√µes</span>
                    </div>

                    <!-- Price -->
                    <div class="product-price mb-4">
                        <div class="current-price text-success" id="current-price" style="font-size: 2.2rem; font-weight: bold;">R${{ "%.2f"|format(product.price) }}</div>
                        {% if product.original_price %}
                            <div class="price-details">
                                <span class="discount-badge bg-success text-white px-2 py-1 rounded">-{{ product.discount }}% OFF</span>
                                <div class="original-price text-muted text-decoration-line-through" id="original-price" style="font-size: 1.2rem;">R${{ "%.2f"|format(product.original_price) }}</div>
                            </div>
                        {% endif %}
                    </div>

                    <!-- Quantity and Buy Button -->
                    <div class="purchase-section mb-4">
                        <div class="row align-items-center">
                            <div class="col-4">
                                <div class="quantity-selector d-flex align-items-center border rounded">
                                    <button class="btn btn-sm quantity-decrease" type="button" style="border: none; background: none; color: #666; font-size: 18px; padding: 8px 12px;">-</button>
                                    <div class="quantity-display text-center" style="min-width: 40px; font-weight: 600; font-size: 16px; color: #333;">1</div>
                                    <input type="number" class="form-control text-center border-0 quantity-input" value="1" min="1" data-price="{{ product.price }}" style="display: none;">
                                    <button class="btn btn-sm quantity-increase" type="button" style="border: none; background: none; color: #666; font-size: 16px; padding: 8px 12px;">+</button>
                                </div>
                            </div>
                            <div class="col-8">
                                <button class="btn-comprar-melhorado" onclick="buyProduct()">
                                    Comprar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Shipping Info -->
                    <div class="shipping-section mb-4">
                        <h6>üöö Frete gr√°tis a partir de R$ 100</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Description -->
    <div class="container mt-5">
        <div class="product-description">
            <h3>Descri√ß√£o</h3>
            <div class="description-content">
                <p>O <strong>{{ product.name.split(':')[0] if ':' in product.name else product.name }}</strong> √© como um carinho em forma de fragr√¢ncia. Inspirado na leveza das nuvens e na do√ßura do algod√£o doce, ele transforma a sua rotina de autocuidado em um momento suave, doce e cheio de afeto.</p>
                
                <p>Com uma fragr√¢ncia delicadamente envolvente, esse duo une a hidrata√ß√£o que sua pele merece com um perfume leve, alegre e marcante na medida certa.</p>
                
                <h5>Voc√™ vai amar porque:</h5>
                <ul>
                    <li>Tem aquele cheirinho doce, leve e encantador que te faz se sentir abra√ßada.</li>
                    <li>Hidrata e perfuma ao mesmo tempo, deixando a pele macia e cheirosa o dia todo.</li>
                    <li>√â perfeito para quem ama fragr√¢ncias delicadas, femininas e com um toque de nostalgia.</li>
                </ul>

                <h5>O Kit Cont√©m:</h5>
                <p><strong>C√©u de Algod√£o ‚Äì Lo√ß√£o Hidratante 200ml:</strong> Textura leve, hidrata√ß√£o suave e perfume que permanece.</p>
                <p><strong>C√©u de Algod√£o ‚Äì Body Splash 200ml:</strong> Fragr√¢ncia adocicada e delicada para te acompanhar em todos os momentos.</p>

                <h5>Pir√¢mide Olfativa ‚Äì C√©u de Algod√£o</h5>
                <p><strong>Sa√≠da:</strong> Acorde Algod√£o Doce, Lim√£o, Mandarina</p>
                <p><strong>Corpo:</strong> Jasmim, Fava Tonka, Anis</p>
                <p><strong>Fundo:</strong> Musk, Vanilla, Caramelo</p>

                <p><strong>Precau√ß√µes:</strong><br>
                Evite contato com os olhos.<br>
                Mantenha fora do alcance de crian√ßas e animais.<br>
                Em caso de irrita√ß√£o, suspenda o uso e consulte um m√©dico.</p>
            </div>
        </div>
    </div>

    <!-- Reviews Section -->
    <div class="container mt-5">
        <div class="reviews-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3>‚≠ê Avaliar</h3>
                <div>
                    <span class="fw-bold">Avalia√ß√µes</span>
                    <span class="badge bg-secondary">{{ product.review_count }}</span>
                </div>
            </div>

            <!-- Reviews List -->
            <div class="reviews-list">
                {% for review in reviews %}
                <div class="review-item border rounded p-3 mb-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="review-stars">
                            {% for i in range(5) %}
                                <i class="fas fa-star text-warning"></i>
                            {% endfor %}
                        </div>
                        <span class="review-date text-muted">{{ review.date }}</span>
                    </div>
                    
                    <p class="review-text mt-2">{{ review.text }}</p>
                    
                    {% if review.image %}
                    <div class="review-image mb-2">
                        <img src="{{ review.image }}" alt="Foto da avalia√ß√£o" class="img-thumbnail" style="max-width: 150px;">
                    </div>
                    {% endif %}
                    
                    <div class="reviewer-name text-end">
                        <strong>{{ review.name }}</strong>
                    </div>
                </div>
                {% endfor %}
                
                <!-- Ver mais button -->
                <div class="text-center mt-4">
                    <button class="btn-secundario">Ver mais avalia√ß√µes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Similar Products -->
    {% if similar_products %}
    <div class="container mt-5">
        <h3 class="mb-4">Produtos similares</h3>
        <div class="row">
            {% for product in similar_products %}
            <div class="col-6 col-md-3 mb-4">
                <div class="product-card">
                    <div class="product-image">
                        <img src="{{ product.image_url }}" alt="{{ product.name }}" class="img-fluid">
                    </div>
                    <div class="product-info p-3">
                        <h6 class="product-name">{{ product.name }}</h6>
                        <div class="product-price">
                            <span class="current-price fw-bold">R${{ "%.2f"|format(product.price) }}</span>
                            {% if product.original_price %}
                                <div class="price-discount">
                                    <span class="discount-badge">-{{ product.discount }}% OFF</span>
                                    <span class="original-price text-muted text-decoration-line-through">R${{ "%.2f"|format(product.original_price) }}</span>
                                </div>
                            {% endif %}
                        </div>
                        <a href="{{ url_for('product_detail', product_id=product.id) }}" class="btn-comprar-melhorado mt-2">
                            Comprar
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const quantityInput = document.querySelector('.quantity-input');
    const quantityDisplay = document.querySelector('.quantity-display');
    const decreaseBtn = document.querySelector('.quantity-decrease');
    const increaseBtn = document.querySelector('.quantity-increase');
    const currentPriceEl = document.getElementById('current-price');
    const originalPriceEl = document.getElementById('original-price');
    const installmentsEl = document.getElementById('installments');
    
    const basePrice = parseFloat(quantityInput.dataset.price);
    const baseOriginalPrice = {{ product.original_price or 'null' }};
    
    function updatePrice() {
        const quantity = parseInt(quantityInput.value) || 1;
        const totalPrice = basePrice * quantity;
        const totalOriginalPrice = baseOriginalPrice ? baseOriginalPrice * quantity : null;
        
        // Update quantity display
        quantityDisplay.textContent = quantity;
        
        // Update current price
        currentPriceEl.textContent = `R$${totalPrice.toFixed(2).replace('.', ',')}`;
        
        // Update original price if exists
        if (originalPriceEl && totalOriginalPrice) {
            originalPriceEl.textContent = `R$${totalOriginalPrice.toFixed(2).replace('.', ',')}`;
        }
        
        // Update installments
        const installmentValue = totalPrice / 12;
        installmentsEl.textContent = `12x de R$${installmentValue.toFixed(2).replace('.', ',')}`;
    }
    
    // Decrease quantity
    decreaseBtn.addEventListener('click', function() {
        let quantity = parseInt(quantityInput.value) || 1;
        if (quantity > 1) {
            quantity--;
            quantityInput.value = quantity;
            updatePrice();
        }
    });
    
    // Increase quantity
    increaseBtn.addEventListener('click', function() {
        let quantity = parseInt(quantityInput.value) || 1;
        quantity++;
        quantityInput.value = quantity;
        updatePrice();
    });
    
    // Buy product function
    window.buyProduct = function() {
        const quantity = parseInt(quantityInput.value) || 1;
        window.location.href = `/buy/{{ product.id }}?quantity=${quantity}`;
    };
});
</script>
{% endblock %}